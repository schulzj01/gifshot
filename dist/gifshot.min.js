/*Copyrights for code authored by Yahoo Inc. is licensed under the following terms:
MIT License
Copyright  2017 Yahoo Inc.
Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:
The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
*/
!function(e,D,t,N){"use strict";const q={URL:e.URL||e.webkitURL||e.mozURL||e.msURL,getUserMedia:(r=t.getUserMedia||t.webkitGetUserMedia||t.mozGetUserMedia||t.msGetUserMedia)&&r.bind(t),requestAnimFrame:e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||e.msRequestAnimationFrame,requestTimeout:(t,r)=>{if(t=t||q.noop,r=r||0,!q.requestAnimFrame)return setTimeout(t,r);const i=(new Date).getTime();let o=new Object;const n=q.requestAnimFrame,a=()=>{var e=(new Date).getTime()-i;r<=e?t.call():o.value=n(a)};return o.value=n(a),o},Blob:e.Blob||e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||e.MSBlobBuilder,btoa:(r=e.btoa||function(e){let t="",r=0;var i,o,n,a,s=e.length,d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let l,c;for(;r<s;)a=e.charCodeAt(r++),i=e.charCodeAt(r++),o=e.charCodeAt(r++),n=a>>2,a=(3&a)<<4|i>>4,l=(15&i)<<2|o>>6,c=63&o,isNaN(i)?l=c=64:isNaN(o)&&(c=64),t=t+d.charAt(n)+d.charAt(a)+d.charAt(l)+d.charAt(c);return t})?r.bind(e):q.noop,isObject:e=>e&&"[object Object]"===Object.prototype.toString.call(e),isEmptyObject:e=>q.isObject(e)&&!Object.keys(e).length,isArray:e=>e&&Array.isArray(e),isFunction:e=>e&&"function"==typeof e,isElement:e=>e&&1===e.nodeType,isString:e=>"string"==typeof e||"[object String]"===Object.prototype.toString.call(e),isSupported:{canvas:()=>{var e=D.createElement("canvas");return e&&e.getContext&&e.getContext("2d")},webworkers:()=>e.Worker,blob:()=>q.Blob,Uint8Array:()=>e.Uint8Array,Uint32Array:()=>e.Uint32Array,videoCodecs:(()=>{var e=D.createElement("video"),t={mp4:!1,h264:!1,ogv:!1,ogg:!1,webm:!1};try{e&&e.canPlayType&&(t.mp4=""!==e.canPlayType('video/mp4; codecs="mp4v.20.8"'),t.h264=""!==(e.canPlayType('video/mp4; codecs="avc1.42E01E"')||e.canPlayType('video/mp4; codecs="avc1.42E01E, mp4a.40.2"')),t.ogv=""!==e.canPlayType('video/ogg; codecs="theora"'),t.ogg=""!==e.canPlayType('video/ogg; codecs="theora"'),t.webm=-1!==e.canPlayType('video/webm; codecs="vp8, vorbis"'))}catch(e){}return t})()},noop:()=>{},each:(e,t)=>{let r;var i;if(q.isArray(e))for(r=-1,i=e.length;++r<i&&!1!==t(r,e[r]););else if(q.isObject(e))for(r in e)if(e.hasOwnProperty(r)&&!1===t(r,e[r]))break},mergeOptions:(o,n)=>{if(q.isObject(o)&&q.isObject(n)&&Object.keys){let i={};return q.each(o,(e,t)=>{i[e]=o[e]}),q.each(n,(e,t)=>{var r=n[e];q.isObject(r)&&o[e]?i[e]=q.mergeOptions(o[e],r):i[e]=r}),i}},setCSSAttr:(r,e,t)=>{q.isElement(r)&&(q.isString(e)&&q.isString(t)?r.style[e]=t:q.isObject(e)&&q.each(e,function(e,t){r.style[e]=t}))},removeElement:e=>{q.isElement(e)&&e.parentNode&&e.parentNode.removeChild(e)},createWebWorker:e=>{if(!q.isString(e))return{};try{var t=new q.Blob([e],{type:"text/javascript"}),r=q.URL.createObjectURL(t);return{objectUrl:r,worker:new Worker(r)}}catch(e){return""+e}},getExtension:e=>e.substr(e.lastIndexOf(".")+1,e.length),getFontSize:(e={})=>{if(!D.body||!1===e.resizeFont)return e.fontSize;var t=e.text,r=e.gifWidth;let i=parseInt(e.fontSize,10);var o=parseInt(e.minFontSize,10),e=D.createElement("div"),n=D.createElement("span");for(e.setAttribute("width",r),e.appendChild(n),n.innerHTML=t,n.style.fontSize=i+"px",n.style.textIndent="-9999px",n.style.visibility="hidden",D.body.appendChild(n);n.offsetWidth>r&&i>=o;)n.style.fontSize=--i+"px";return D.body.removeChild(n),i+"px"},webWorkerError:!1};t=Object.freeze({__proto__:null,default:q});const m={validate:i=>{i=q.isObject(i)?i:{};let o={};return q.each(m.validators,(e,t)=>{var r=t.errorCode;if(!i[r]&&!t.condition)return!((o=t).error=!0)}),delete o.condition,o},isValid:e=>{return!0!==m.validate(e).error},validators:[{condition:q.isFunction(q.getUserMedia),errorCode:"getUserMedia",errorMsg:"The getUserMedia API is not supported in your browser"},{condition:q.isSupported.canvas(),errorCode:"canvas",errorMsg:"Canvas elements are not supported in your browser"},{condition:q.isSupported.webworkers(),errorCode:"webworkers",errorMsg:"The Web Workers API is not supported in your browser"},{condition:q.isFunction(q.URL),errorCode:"window.URL",errorMsg:"The window.URL API is not supported in your browser"},{condition:q.isSupported.blob(),errorCode:"window.Blob",errorMsg:"The window.Blob File API is not supported in your browser"},{condition:q.isSupported.Uint8Array(),errorCode:"window.Uint8Array",errorMsg:"The window.Uint8Array function constructor is not supported in your browser"},{condition:q.isSupported.Uint32Array(),errorCode:"window.Uint32Array",errorMsg:"The window.Uint32Array function constructor is not supported in your browser"}],messages:{videoCodecs:{errorCode:"videocodec",errorMsg:"The video codec you are trying to use is not supported in your browser"}}};var r=Object.freeze({__proto__:null,default:m}),i=()=>{};const g={sampleInterval:10,numWorkers:2,filter:"",gifWidth:200,gifHeight:200,interval:.1,numFrames:10,frameDuration:1,keepCameraOn:!1,images:[],video:null,webcamVideoElement:null,cameraStream:null,text:"",fontWeight:"normal",fontSize:"16px",minFontSize:"10px",resizeFont:!1,fontFamily:"sans-serif",fontColor:"#ffffff",textAlign:"center",textBaseline:"bottom",textXCoordinate:null,textYCoordinate:null,progressCallback:i,completeCallback:i,saveRenderingContexts:!1,savedRenderingContexts:[],showFrameText:!0,crossOrigin:"Anonymous",waterMark:null,waterMarkHeight:null,waterMarkWidth:null,waterMarkXCoordinate:1,waterMarkYCoordinate:1};i=Object.freeze({__proto__:null,default:g});function h(){return m.isValid()}function u(){var M,A,R,U,T,I=256,j=499,V=491,H=487,z=503,L=3*z,f=I-1,P=4,B=100,G=16,n=1<<G,D=10,N=10,q=n>>N,_=n<<D-N,X=6,Y=(I>>3)*(1<<X),Q=30,K=1024,$=256,J=1<<18,p=[],Z=[],ee=[],te=[];function v(){var e,t,r,i,o,n,a,s,d,l,c,m,g,h;for(M=30+((U=R<L?1:U)-1)/3,m=A,l=(c=(h=R)/(3*U))/B|(g=0),s=K,(a=(n=Y)>>X)<=1&&(a=0),e=0;e<a;e++)te[e]=s*((a*a-e*e)*$/(a*a));for(d=R<L?3:R%j!=0?3*j:R%V!=0?3*V:R%H!=0?3*H:3*z,e=0;e<c;){t=function(e,t,r){var i,o,n,a,s,d,l,c;for(l=d=~(1<<31),s=a=-1,i=0;i<I;i++)c=T[i],(o=c[0]-e)<0&&(o=-o),n=c[1]-t,o+=n=n<0?-n:n,n=c[2]-r,(o+=n=n<0?-n:n)<d&&(d=o,a=i),(c=o-(Z[i]>>G-P))<l&&(l=c,s=i),n=ee[i]>>N,ee[i]-=n,Z[i]+=n<<D;return ee[a]+=q,Z[a]-=_,s}(r=(255&m[g+0])<<P,i=(255&m[g+1])<<P,o=(255&m[g+2])<<P),b=v=p=f=u=void 0;var u=s,f=t,p=r,v=i,b=o;if(f=T[f],u/=K,f[0]-=u*(f[0]-p)|0,f[1]-=u*(f[1]-v)|0,f[2]-=u*(f[2]-b)|0,0!==a){F=x=S=C=k=y=w=E=O=W=v=p=void 0;var w,y,k,C,S,x,F,p=a,v=t,W=r,O=i,E=o;for((k=v-p)<-1&&(k=-1),(C=v+p)>I&&(C=I),w=v+1,y=v-1,x=1;w<C||k<y;){if(S=te[x++],w<C){F=T[w++];try{F[0]-=S*(F[0]-W)/J|0,F[1]-=S*(F[1]-O)/J|0,F[2]-=S*(F[2]-E)/J|0}catch(e){}}if(k<y){F=T[y--];try{F[0]-=S*(F[0]-W)/J|0,F[1]-=S*(F[1]-O)/J|0,F[2]-=S*(F[2]-E)/J|0}catch(e){}}}}if(h<=(g+=d)&&(g-=R),++e%(l=0===l?1:l)==0)for(s-=s/M,(a=(n-=n/Q)>>X)<=1&&(a=0),t=0;t<a;t++)te[t]=s*((a*a-t*t)*$/(a*a))}}!function(e,t,r){var i,o;for(A=e,R=t,U=r,T=new Array(I),i=0;i<I;i++)T[i]=new Array(4),(o=T[i])[0]=o[1]=o[2]=(i<<P+8)/I|0,ee[i]=n/I|0,Z[i]=0}.apply(this,arguments);var e={map:function(e,t,r){for(var i,o,n,a=1e3,s=-1,d=p[t],l=d-1;d<I||0<=l;)d<I&&(a<=(i=(n=T[d])[1]-t)?d=I:(d++,i<0&&(i=-i),(i+=o=(o=n[0]-e)<0?-o:o)<a&&(i+=o=(o=n[2]-r)<0?-o:o)<a&&(a=i,s=n[3]))),0<=l&&(a<=(i=t-(n=T[l])[1])?l=-1:(l--,i<0&&(i=-i),(i+=o=(o=n[0]-e)<0?-o:o)<a&&(i+=o=(o=n[2]-r)<0?-o:o)<a&&(a=i,s=n[3])));return s}};return e.process=function(){var e;for(v(),e=0;e<I;e++)T[e][0]>>=P,T[e][1]>>=P,T[e][2]>>=P,T[e][3]=e;for(var t,r,i,o,n,a=0,s=0,d=0;d<I;d++){for(i=(o=T[r=d])[1],t=d+1;t<I;t++)(n=T[t])[1]<i&&(r=t,i=n[1]);if(n=T[r],d!=r&&(t=n[0],n[0]=o[0],o[0]=t,t=n[1],n[1]=o[1],o[1]=t,t=n[2],n[2]=o[2],o[2]=t,t=n[3],n[3]=o[3],o[3]=t),i!=a){for(p[a]=s+d>>1,t=a+1;t<i;t++)p[t]=d;a=i,s=d}}for(p[a]=s+f>>1,t=a+1;t<256;t++)p[t]=f;for(var l=[],c=new Array(I),m=0;m<I;m++)c[T[m][3]]=m;for(var g=0,h=0;h<I;h++){var u=c[h];l[g++]=T[u][0],l[g++]=T[u][1],l[g++]=T[u][2]}return l},e}function d(){try{this.onmessage=function(e){var e=e.data||{};e.gifshot&&(e=t.run(e),postMessage(e))}}catch(e){}const t={dataToRGB:function(e,t,r){var i=t*r*4;let o=0;for(var n=[];o<i;)n.push(e[o++]),n.push(e[o++]),n.push(e[o++]),o++;return n},componentizedPaletteToArray:function(t){t=t||[];var r=[];for(let e=0;e<t.length;e+=3){var i=t[e],o=t[e+1],n=t[e+2];r.push(i<<16|o<<8|n)}return r},processFrameWithQuantizer:function(e,t,r,i){var o=this.dataToRGB(e,t,r),n=new u(o,o.length,i),e=n.process(),i=new Uint32Array(this.componentizedPaletteToArray(e)),a=t*r,s=new Uint8Array(a);let d=0;for(let e=0;e<a;e++){var l=o[d++],c=o[d++],m=o[d++];s[e]=n.map(l,c,m)}return{pixels:s,palette:i}},run:function(e){var{height:t,sampleInterval:r,width:i}=e=e||{},e=e.data;return this.processFrameWithQuantizer(e,i,t,r)}};return t}function f(v,e,t,r){var b=0,i=(r=r===N?{}:r).loop===N?null:r.loop,w=r.palette===N?null:r.palette;if(e<=0||t<=0||65535<e||65535<t)throw"Width/Height invalid.";v[b++]=71,v[b++]=73,v[b++]=70,v[b++]=56,v[b++]=57,v[b++]=97;if(v[b++]=255&e,v[b++]=e>>8&255,v[b++]=255&t,v[b++]=t>>8&255,v[b++]=0|(null!==w?128:0),v[b++]=0,v[b++]=0,null!==i){if(i<0||65535<i)throw"Loop count invalid.";v[b++]=33,v[b++]=255,v[b++]=11,v[b++]=78,v[b++]=69,v[b++]=84,v[b++]=83,v[b++]=67,v[b++]=65,v[b++]=80,v[b++]=69,v[b++]=50,v[b++]=46,v[b++]=48,v[b++]=3,v[b++]=1,v[b++]=255&i,v[b++]=i>>8&255,v[b++]=0}var y=!1;this.addFrame=function(e,t,r,i,o,n){if(!0===y&&(--b,y=!1),e<0||t<0||65535<e||65535<t)throw"x/y invalid.";if(r<=0||i<=0||65535<r||65535<i)throw"Width/Height invalid.";if(o.length<r*i)throw"Not enough pixels for the frame size.";var a=!0,s=(n=n===N?{}:n).palette;if(s!==N&&null!==s||(a=!1,s=w),s===N||null===s)throw"Must supply either a local or global palette.";for(var d=function(e){if((e=e.length)<2||256<e||e&e-1)throw"Invalid code/color length, must be power of 2 and 2 .. 256.";return e}(s),l=0;d>>=1;)++l;var d=1<<l,c=n.delay===N?0:n.delay,m=n.disposal===N?0:n.disposal;if(m<0||3<m)throw"Disposal out of range.";var g=!1,h=0;if(n.transparent!==N&&null!==n.transparent&&(g=!0,(h=n.transparent)<0||d<=h))throw"Transparent color index.";if(0===m&&!g&&0===c||(v[b++]=33,v[b++]=249,v[b++]=4,v[b++]=m<<2|(!0===g?1:0),v[b++]=255&c,v[b++]=c>>8&255,v[b++]=h,v[b++]=0),v[b++]=44,v[b++]=255&e,v[b++]=e>>8&255,v[b++]=255&t,v[b++]=t>>8&255,v[b++]=255&r,v[b++]=r>>8&255,v[b++]=255&i,v[b++]=i>>8&255,v[b++]=!0===a?128|l-1:0,!0===a)for(var u=0,f=s.length;u<f;++u){var p=s[u];v[b++]=p>>16&255,v[b++]=p>>8&255,v[b++]=255&p}b=function(t,r,e,i){t[r++]=e;var o=r++,n=1<<e,a=n-1,s=1+n,d=1+s,l=e+1,c=0,m=0;function g(e){for(;e<=c;)t[r++]=255&m,m>>=8,c-=8,r===o+256&&(t[o]=255,o=r++)}function h(e){m|=e<<c,c+=l,g(8)}var u=i[0]&a,f={};h(n);for(var p=1,v=i.length;p<v;++p){var b=i[p]&a,w=u<<8|b,y=f[w];if(y===N){for(m|=u<<c,c+=l;8<=c;)t[r++]=255&m,m>>=8,c-=8,r===o+256&&(t[o]=255,o=r++);4096===d?(h(n),d=1+s,l=e+1,f={}):(1<<l<=d&&++l,f[w]=d++),u=b}else u=y}h(u),h(s),g(1),o+1===r?t[o]=0:(t[o]=r-o-1,t[r++]=0);return r}(v,b,l<2?2:l,o)},this.end=function(){return!1===y&&(v[b++]=59,y=!0),b}}const o=()=>{},_=function(e){this.canvas=null,this.ctx=null,this.repeat=0,this.frames=[],this.numRenderedFrames=0,this.onRenderCompleteCallback=o,this.onRenderProgressCallback=o,this.workers=[],this.availableWorkers=[],this.generatingGIF=!1,this.options=e,this.initializeWebWorkers(e)};function p(e={}){const{callback:o,images:t,options:n}=e;let a=e.imagesLength;e=m.validate({getUserMedia:!0,"window.URL":!0});let s=[],d=0,l,r;if(e.error)return o(e);function c(){var e,t;q.each(s,function(e,t){t&&(t.text?r.addFrame(t.img,n,t.text):r.addFrame(t,n))}),e=r,t=o,e.getBase64GIF(e=>{t({error:!1,errorCode:"",errorMsg:"",image:e})})}r=new _(n),q.each(t,function(t,r){let e=r;var i;r.src&&(e=e.src),q.isElement(e)?(n.crossOrigin&&(e.crossOrigin=n.crossOrigin),s[t]=e,(d+=1)===a&&c()):q.isString(e)&&(l=new Image,n.crossOrigin&&(l.crossOrigin=n.crossOrigin),i=l,r.text&&(i.text=r.text),i.onerror=function(e){var t;if(0===--a)return t={error:"None of the requested images was capable of being retrieved"},o(t)},i.onload=function(e){r.text?s[t]={img:i,text:i.text}:s[t]=i,(d+=1)===a&&c(),q.removeElement(i)},i.src=e,q.setCSSAttr(l,{position:"fixed",opacity:"0"}),D.body.appendChild(l))})}_.prototype={workerMethods:d(),initializeWebWorkers:function(e){var t,r,i,o,n=u.toString()+"("+d.toString()+"());";let a=-1,s="";for(o=e.numWorkers;++a<o;)t=q.createWebWorker(n),q.isObject(t)?(r=t.objectUrl,i=t.worker,this.workers.push({worker:i,objectUrl:r}),this.availableWorkers.push(i)):(s=t,q.webWorkerError=!!t);this.workerError=s,this.canvas=D.createElement("canvas"),this.canvas.width=e.gifWidth,this.canvas.height=e.gifHeight,this.ctx=this.canvas.getContext("2d"),this.frames=[]},getWorker:function(){return this.availableWorkers.pop()},freeWorker:function(e){this.availableWorkers.push(e)},byteMap:(()=>{var t=[];for(let e=0;e<256;e++)t[e]=String.fromCharCode(e);return t})(),bufferToString:function(e){var t=e.length;let r="",i=-1;for(;++i<t;)r+=this.byteMap[e[i]];return r},onFrameFinished:function(e){const t=this;var r=t.frames,i=!!(t.options.images||[]).length,o=r.every(e=>!e.beingProcessed&&e.done);t.numRenderedFrames++,i&&e(t.numRenderedFrames/r.length),t.onRenderProgressCallback(.75*t.numRenderedFrames/r.length),o?t.generatingGIF||t.generateGIF(r,t.onRenderCompleteCallback):q.requestTimeout(function(){t.processNextFrame()},1)},processFrame:function(e){const t=this,{progressCallback:r,sampleInterval:i}=(this.options,this.options);var o=this.frames;let n,a;var s=(e={})=>{e=e.data;delete n.data,n.pixels=Array.prototype.slice.call(e.pixels),n.palette=Array.prototype.slice.call(e.palette),n.done=!0,n.beingProcessed=!1,t.freeWorker(a),t.onFrameFinished(r)};(n=o[e]).beingProcessed||n.done?this.onFrameFinished():(n.sampleInterval=i,n.beingProcessed=!0,n.gifshot=!0,(a=this.getWorker())?(a.onmessage=s,a.postMessage(n)):s({data:t.workerMethods.run(n)}))},startRendering:function(e){this.onRenderCompleteCallback=e;for(let e=0;e<this.options.numWorkers&&e<this.frames.length;e++)this.processFrame(e)},processNextFrame:function(){let t=-1;for(let e=0;e<this.frames.length;e++){var r=this.frames[e];if(!r.done&&!r.beingProcessed){t=e;break}}0<=t&&this.processFrame(t)},generateGIF:function(o,e){var t=[],r={loop:this.repeat},i=this.options,n=i["interval"];const a=i.frameDuration,s=i.images,d=!!s.length,l=i.gifHeight,c=i.gifWidth;i=new f(t,c,l,r);const m=this.onRenderProgressCallback,g=d?100*n:0;this.generatingGIF=!0,q.each(o,(e,t)=>{var r=t.palette;m(.75+.25*t.position*1/o.length);for(let e=0;e<a;e++){var i=d&&s[t.position].hasOwnProperty("interval")?100*s[t.position].interval:g;gifWriter$$1.addFrame(0,0,c,l,t.pixels,{palette:r,delay:i})}}),i.end(),m(1),this.frames=[],this.generatingGIF=!1,q.isFunction(e)&&(r=this.bufferToString(t),e("data:image/gif;base64,"+q.btoa(r)))},setRepeat:function(e){this.repeat=e},addFrame:function(e,t,r){t=q.isObject(t)?t:{};var i,o=this.ctx,n=this.options,a=n.gifWidth,n=n.gifHeight,s=q.getFontSize(t),{filter:d,fontColor:l,fontFamily:c,fontWeight:m,text:g,textAlign:h,textBaseline:u,waterMark:f,waterMarkHeight:p,waterMarkWidth:v,waterMarkXCoordinate:b,waterMarkYCoordinate:w}=t,y=t.textXCoordinate||("left"===h?1:"right"===h?a:a/2),k=t.textYCoordinate||("top"===u?1:"center"===u?n/2:n),m=m+" "+s+" "+c;const C=r&&t.showFrameText?r:g;try{if(o.filter=d,o.drawImage(e,0,0,a,n),C){o.font=m,o.fillStyle=l,o.textAlign=h,o.textBaseline=u;var S,x=["\n","\t","<br/>","<br>","<hr>"].find(e=>C.includes(e)),F=(x&&(S=C.split(x)),Number(s.replace("px",""))),W=(F+16)*S.length;o.fillStyle="rgba(0, 0, 0, 0.7)",o.fillRect(0,n,a,-W),o.fillStyle=l;for(var O=0;O<S.length;O++)o.fillText(S[O],y,k-(O*F+16))}f&&o.drawImage(f,b,w,v,p),i=o.getImageData(0,0,a,n),this.addFrameImageData(i)}catch(e){return""+e}},addFrameImageData:function(e={}){var t=this.frames,r=e.data;this.frames.push({data:r,width:e.width,height:e.height,palette:null,dithering:null,done:!1,beingProcessed:!1,position:t.length})},onRenderProgress:function(e){this.onRenderProgressCallback=e},isRendering:function(){return this.generatingGIF},getBase64GIF:function(t){const r=this;r.startRendering(e=>{r.destroyWorkers(),q.requestTimeout(()=>{t(e)},0)})},destroyWorkers:function(){var e;this.workerError||(e=this.workers,q.each(e,(e,t)=>{var r=t.worker,t=t.objectUrl;r.terminate(),q.URL.revokeObjectURL(t)}))}};const X=()=>{},v={getGIF:(e={},r)=>{r=q.isFunction(r)?r:X;var t=D.createElement("canvas");let i;var o=!!e.images.length;const{cameraStream:n,crop:a,filter:s,fontColor:d,fontFamily:l,fontWeight:c,keepCameraOn:m,progressCallback:g,saveRenderingContexts:h,savedRenderingContexts:u,text:f,textAlign:p,textBaseline:v,videoElement:b,videoHeight:w,videoWidth:y,webcamVideoElement:k,waterMark:C,waterMarkHeight:S,waterMarkWidth:x,waterMarkXCoordinate:V,waterMarkYCoordinate:H}=e;let F=Number(e.gifWidth),W=Number(e.gifHeight);var z=Number(e.interval);Number(e.sampleInterval);let L=o?0:1e3*z,O=[],E=u.length||e.numFrames,M=E,A=new _(e);o=q.getFontSize(e);let P=e.textXCoordinate||("left"===p?1:"right"===p?F:F/2),B=e.textYCoordinate||("top"===v?1:"center"===v?W/2:W),G=c+" "+o+" "+l,R=a?Math.floor(a.scaledWidth/2):0,U=a?y-a.scaledWidth:0,T=a?Math.floor(a.scaledHeight/2):0,I=a?w-a.scaledHeight:0;function j(){const t=M-1;function e(){var e;h&&O.push(i.getImageData(0,0,F,W)),C&&i.drawImage(C,V,H,x,S),f&&(i.font=G,i.fillStyle=d,i.textAlign=p,i.textBaseline=v,i.fillText(f,P,B)),e=i.getImageData(0,0,F,W),A.addFrameImageData(e),M=t,g((E-M)/E),0<t&&q.requestTimeout(j,L),M||A.getBase64GIF(e=>{r({error:!1,errorCode:"",errorMsg:"",image:e,cameraStream:n,videoElement:b,webcamVideoElement:k,savedRenderingContexts:O,keepCameraOn:m})})}(u.length?(i.putImageData(u[E-M],0,0),e):function t(){try{U>y&&(U=y),I>w&&(I=w),R<0&&(R=0),T<0&&(T=0),i.filter=s,i.drawImage(b,R,T,U,I,0,0,F,W),e()}catch(e){if("NS_ERROR_NOT_AVAILABLE"!==e.name)throw e;q.requestTimeout(t,100)}})()}E=E!==N?E:10,t.width=F,t.height=W,i=t.getContext("2d"),function e(){u.length||0!==b.currentTime?j():q.requestTimeout(e,100)}()},getCropDimensions:(e={})=>{var t=e.videoWidth,r=e.videoHeight,i=e.gifWidth,e=e.gifHeight,o={width:0,height:0,scaledWidth:0,scaledHeight:0};return r<t?(o.width=Math.round(t*(e/r))-i,o.scaledWidth=Math.round(o.width*(r/e))):(o.height=Math.round(r*(i/t))-e,o.scaledHeight=Math.round(o.height*(t/i))),o}},b={loadedData:!1,defaultVideoDimensions:{width:640,height:480},findVideoSize:function e(t){e.attempts=e.attempts||0;var{cameraStream:r,completedCallback:i,videoElement:o}=t;o&&(0<o.videoWidth&&0<o.videoHeight?(o.removeEventListener("loadeddata",b.findVideoSize),i({videoElement:o,cameraStream:r,videoWidth:o.videoWidth,videoHeight:o.videoHeight})):e.attempts<10?(e.attempts+=1,q.requestTimeout(function(){b.findVideoSize(t)},400)):i({videoElement:o,cameraStream:r,videoWidth:b.defaultVideoDimensions.width,videoHeight:b.defaultVideoDimensions.height}))},onStreamingTimeout:e=>{q.isFunction(e)&&e({error:!0,errorCode:"getUserMedia",errorMsg:"There was an issue with the getUserMedia API - Timed out while trying to start streaming",image:null,cameraStream:{}})},stream:e=>{var t=q.isArray(e.existingVideo)?e.existingVideo[0]:e.existingVideo;const{cameraStream:r,completedCallback:i,streamedCallback:o,videoElement:n}=e;if(q.isFunction(o)&&o(),t){if(q.isString(t))n.src=t,n.innerHTML='<source src="'+t+'" type="video/'+q.getExtension(t)+'" />';else if(t instanceof Blob){try{n.src=q.URL.createObjectURL(t)}catch(e){}n.innerHTML='<source src="'+t+'" type="'+t.type+'" />'}}else if(n.mozSrcObject)n.mozSrcObject=r;else if(q.URL)try{n.srcObject=r,n.src=q.URL.createObjectURL(r)}catch(e){n.srcObject=r}n.play(),q.requestTimeout(function e(){e.count=e.count||0,!0===b.loadedData?(b.findVideoSize({videoElement:n,cameraStream:r,completedCallback:i}),b.loadedData=!1):10<(e.count+=1)?b.findVideoSize({videoElement:n,cameraStream:r,completedCallback:i}):e()},0)},startStreaming:e=>{var t=q.isFunction(e.error)?e.error:q.noop;const r=q.isFunction(e.streamed)?e.streamed:q.noop,i=q.isFunction(e.completed)?e.completed:q.noop,{crossOrigin:o,existingVideo:n,lastCameraStream:a,options:s,webcamVideoElement:d}=e,l=q.isElement(n)?n:d||D.createElement("video");o&&(l.crossOrigin=s.crossOrigin),l.autoplay=!0,l.loop=!0,l.muted=!0,l.addEventListener("loadeddata",e=>{b.loadedData=!0,s.offset&&(l.currentTime=s.offset)}),n?b.stream({videoElement:l,existingVideo:n,completedCallback:i}):a?b.stream({videoElement:l,cameraStream:a,streamedCallback:r,completedCallback:i}):q.getUserMedia({video:!0},function(e){b.stream({videoElement:l,cameraStream:e,streamedCallback:r,completedCallback:i})},t)},startVideoStreaming:(o,e={})=>{var t=e.timeout!==N?e.timeout:0;const r=e.callback;var i=e.webcamVideoElement;let n;0<t&&(n=q.requestTimeout(()=>{b.onStreamingTimeout(r)},1e4)),b.startStreaming({error:()=>{r({error:!0,errorCode:"getUserMedia",errorMsg:"There was an issue with the getUserMedia API - the user probably denied permission",image:null,cameraStream:{}})},streamed:()=>{clearTimeout(n)},completed:(e={})=>{var{cameraStream:e,videoElement:t,videoHeight:r,videoWidth:i}=e;o({cameraStream:e,videoElement:t,videoHeight:r,videoWidth:i})},lastCameraStream:e.lastCameraStream,webcamVideoElement:i,crossOrigin:e.crossOrigin,options:e})},stopVideoStreaming:e=>{var{keepCameraOn:t,videoElement:r,webcamVideoElement:i}=e=q.isObject(e)?e:{},e=e.cameraStream||{},e=e.getTracks&&e.getTracks()||[],o=!!e.length,e=e[0];!t&&o&&q.isFunction(e.stop)&&e.stop(),q.isElement(r)&&!i&&(r.pause(),q.isFunction(q.URL.revokeObjectURL)&&!q.webWorkerError&&r.src&&q.URL.revokeObjectURL(r.src),q.removeElement(r))}};function w(e){e=q.isObject(e)?e:{},b.stopVideoStreaming(e)}function y(e,t){var r=e.options||{};const{images:i,video:o}=r;var n=Number(r.gifWidth),a=Number(r.gifHeight),{cameraStream:e,videoElement:s,videoWidth:d,videoHeight:l}=(Number(r.numFrames),e),c=v.getCropDimensions({videoWidth:d,videoHeight:l,gifHeight:a,gifWidth:n});const m=t;r.crop=c,r.videoElement=s,r.videoWidth=d,r.videoHeight=l,r.cameraStream=e,q.isElement(s)&&(s.width=n+c.width,s.height=a+c.height,r.webcamVideoElement||(q.setCSSAttr(s,{position:"fixed",opacity:"0"}),D.body.appendChild(s)),s.play(),v.getGIF(r,e=>{i&&i.length||o&&o.length||w(e),m(e)}))}function n(e,n){if(n=q.isFunction(e)?e:n,e=q.isObject(e)?e:{},q.isFunction(n)){var a=q.mergeOptions(g,e)||{},e=e.cameraStream,s=a.images,t=s?s.length:0,d=a.video,r=a.webcamVideoElement,a=q.mergeOptions(a,{gifWidth:Math.floor(a.gifWidth),gifHeight:Math.floor(a.gifHeight)});if(t)p({images:s,imagesLength:t,callback:n,options:a});else if(d){s={existingVideo:d,callback:n,options:a};let{callback:t,existingVideo:r,options:i}=s;s=m.validate({getUserMedia:!0,"window.URL":!0});let o;if(s.error)return void t(s);if(q.isElement(r)&&r.src){if(s=r.src,o=q.getExtension(s),!q.isSupported.videoCodecs[o])return void t(m.messages.videoCodecs)}else q.isArray(r)&&q.each(r,function(e,t){if(o=t instanceof Blob?t.type.substr(t.type.lastIndexOf("/")+1,t.length):t.substr(t.lastIndexOf(".")+1,t.length),q.isSupported.videoCodecs[o])return r=t,!1});b.startStreaming({completed:e=>{e.options=i||{},y(e,t)},existingVideo:r,crossOrigin:i.crossOrigin,options:i})}else{t={lastCameraStream:e,callback:n,webcamVideoElement:r,options:a};const{callback:i,lastCameraStream:o,options:l,webcamVideoElement:c}=t;if(!h())return void i(m.validate());l.savedRenderingContexts.length?v.getGIF(l,e=>{i(e)}):b.startVideoStreaming((e={})=>{e.options=l||{},y(e,i)},{lastCameraStream:o,callback:i,webcamVideoElement:c,crossOrigin:l.crossOrigin})}}}const a={utils:t,error:r,defaultOptions:i,createGIF:n,takeSnapShot:function(e,t){t=q.isFunction(e)?e:t,e=q.isObject(e)?e:{},q.isFunction(t)&&(e=q.mergeOptions(g,e),n(q.mergeOptions(e,{interval:.1,numFrames:1,gifWidth:Math.floor(e.gifWidth),gifHeight:Math.floor(e.gifHeight)}),t))},stopVideoStreaming:w,isSupported:function(){return m.isValid()},isWebCamGIFSupported:h,isExistingVideoGIFSupported:function(e){let r=!1;if(q.isArray(e)&&e.length){if(q.each(e,function(e,t){q.isSupported.videoCodecs[t]&&(r=!0)}),!r)return!1}else if(q.isString(e)&&e.length&&!q.isSupported.videoCodecs[e])return!1;return m.isValid({getUserMedia:!0})},isExistingImagesGIFSupported:function(){return m.isValid({getUserMedia:!0})},VERSION:"0.4.5"};"function"==typeof define&&define.amd?define([],function(){return a}):"undefined"!=typeof exports?module.exports=a:e.gifshot=a}("undefined"!=typeof window?window:{},"undefined"!=typeof document?document:{createElement:function(){}},"undefined"!=typeof window?window.navigator:{});